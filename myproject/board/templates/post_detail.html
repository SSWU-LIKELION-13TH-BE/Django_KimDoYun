{% load static %}

<h2>{{ post.title }}</h2>
<p>ì‘ì„±ì : {{ post.author.username }}</p>
<p>{{ post.content }}</p>
<p>ê¸°ìˆ  ìŠ¤íƒ : {{ post.tech_stack }}</p>
{% if post.github_link %}
    <p><a href="{{ post.github_link }}" target="_blank">GitHub ë§í¬</a></p>
{% endif %}
{% if post.image %}
    <img src="{{ post.image.url }}" alt="ì²¨ë¶€ ì´ë¯¸ì§€">
{% endif %}

<form method="POST" action="{% url 'board:toggle_like' post.pk %}">
    {% csrf_token %}
    {% if is_liked %}
        <button type="submit">ì¢‹ì•„ìš” ì·¨ì†Œ â¤ï¸</button>
    {% else %}
        <button type="submit">ì¢‹ì•„ìš” ğŸ‘</button>
    {% endif %}
    <p>{{ like_count }}ëª…ì´ ì´ ê²Œì‹œë¬¼ì„ ì¢‹ì•„í•©ë‹ˆë‹¤.</p>
    <p>ì¡°íšŒìˆ˜: {{ post.view_count }}</p>
</form>



<h3>ëŒ“ê¸€ ì‘ì„±</h3>
<form method="POST" action="{% url 'board:add_comment' post.pk %}">
    {% csrf_token %}
    {{ form.as_p }}
    <button type="submit">ëŒ“ê¸€ ì‘ì„±</button>
</form>

<!-- ëŒ“ê¸€ ëª©ë¡ -->
<h3>ëŒ“ê¸€ ëª©ë¡</h3>
<ul>
    {% for comment in comments %}
        {% if not comment.parent %}
        <li>
            <strong>{{ comment.user.username }}</strong> : {{ comment.content }}
            <em>({{ comment.created_at }})</em>
            
            <!-- ğŸ’– ëŒ“ê¸€ ì¢‹ì•„ìš” ë²„íŠ¼ -->
            <form method="POST" action="{% url 'board:toggle_comment_like' post.pk comment.id %}">
                {% csrf_token %}
                {% if comment.is_liked %}
                    <button type="submit">â¤ï¸ ì¢‹ì•„ìš” ì·¨ì†Œ</button>
                {% else %}
                    <button type="submit">ğŸ‘ ì¢‹ì•„ìš”</button>
                {% endif %}
            </form>
            <!-- ë‹µê¸€ ë‹¬ê¸° ë²„íŠ¼ -->
            <button onclick="toggleReplyForm('{{ comment.id }}')">ë‹µê¸€ ë‹¬ê¸°</button>

            <!-- ëŒ€ëŒ“ê¸€ ì‘ì„± í¼ (ìˆ¨ê¹€) -->
            <div id="reply-form-{{ comment.id }}" style="display: none; margin-top: 5px;">
                <form method="POST" action="{% url 'board:add_reply' post.pk comment.id %}">
                    {% csrf_token %}
                    {{ form.as_p }}
                    <button type="submit">ì‘ì„±</button>
                </form>
            </div>

            <!-- ëŒ€ëŒ“ê¸€ ë¦¬ìŠ¤íŠ¸ -->
            <ul>
                {% for reply in comments %}
                    {% if reply.parent == comment %}
                    <li style="margin-left: 20px;">
                        â†³ <strong>{{ reply.user.username }}</strong> : {{ reply.content }}
                        <em>({{ reply.created_at }})</em>

                        <!-- ğŸ’¬ ëŒ€ëŒ“ê¸€ ì¢‹ì•„ìš” ë²„íŠ¼ ì¶”ê°€ -->
                        <form method="POST" action="{% url 'board:toggle_comment_like' post.pk reply.id %}">
                            {% csrf_token %}
                            {% if reply.is_liked %}
                                <button type="submit">â¤ï¸ ì¢‹ì•„ìš” ì·¨ì†Œ</button>
                            {% else %}
                                <button type="submit">ğŸ‘ ì¢‹ì•„ìš”</button>
                            {% endif %}
                        </form> 
                    </li>
                    {% endif %}
                {% endfor %}
            </ul>
        </li>
        {% endif %}
    {% empty %}
        <li>ëŒ“ê¸€ì´ ì—†ìŠµë‹ˆë‹¤.</li>
    {% endfor %}
</ul>

<script>
function toggleReplyForm(commentId) {
    const form = document.getElementById('reply-form-' + commentId);
    if (form.style.display === 'none') {
        form.style.display = 'block';
    } else {
        form.style.display = 'none';
    }
}
</script>

